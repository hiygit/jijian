{"remainingRequest":"F:\\纪检项目\\byqc\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!F:\\纪检项目\\byqc\\src\\views\\StandBook\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"F:\\纪检项目\\byqc\\src\\views\\StandBook\\index.vue","mtime":1577010817250},{"path":"F:\\纪检项目\\byqc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\纪检项目\\byqc\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\纪检项目\\byqc\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"F:\\纪检项目\\byqc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"F:\\纪检项目\\byqc\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport Navbar from \"@/components/Navbar/index.vue\";\r\nimport qs from \"qs\";\r\nexport default {\r\n  name: \"StandBook\",\r\n  data() {\r\n    return {\r\n      loading:true,\r\n      userinfo: {}, //用户信息缓存\r\n      totalList: [], //所有数据\r\n      tablearr: [], \r\n      lists: {},\r\n      sourcelist: [], //线索来源\r\n      progresslist: [], //进度\r\n      keyworktext: \"\", //关键字查找\r\n      tableHeadList: [],\r\n      tableData: [],//表格数据\r\n      pages: \"0\",\r\n      page:0,//第几页\r\n      pagesize:10,//每页显示条数\r\n      form: {},\r\n      isChoose: \"\",\r\n      //表格高度\r\n      tableHeight: \"51vh\",\r\n      //图片动态\r\n      src1: require(\"../../assets/talk.png\"),\r\n      src1Active: require(\"../../assets/talkActive.png\"),\r\n      //图片动态\r\n      src2: require(\"../../assets/check.png\"),\r\n      src2Active: require(\"../../assets/checkActive.png\"),\r\n      //图片动态\r\n      src3: require(\"../../assets/search.png\"),\r\n      src3Active: require(\"../../assets/searchActive.png\"),\r\n      //图片动态\r\n      src4: require(\"../../assets/over.png\"),\r\n      src4Active: require(\"../../assets/overActive.png\")\r\n    };\r\n  },\r\n  created() {\r\n    document.title = \"线索台账\";\r\n    //线索来源\r\n    this.$ajax({\r\n      method: \"POST\",\r\n      url: this.globals.requesturl + \"web/dict\",\r\n      data: { type: \"clue_sto_the_source\" },\r\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n      transformRequest: [\r\n        function(data) {\r\n          return qs.stringify(data);\r\n        }\r\n      ]\r\n    }).then(res => {\r\n      if (res.data.success && res.data.errorCode == \"-1\") {\r\n        this.sourcelist = res.data.body.dictValueList;\r\n      } else {\r\n        this.$message.error(res.data.msg);\r\n      }\r\n    });\r\n    //进度\r\n    this.$ajax({\r\n      method: \"POST\",\r\n      url: this.globals.requesturl + \"web/dict\",\r\n      data: { type: \"disponsal_way\" },\r\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n      transformRequest: [\r\n        function(data) {\r\n          return qs.stringify(data);\r\n        }\r\n      ]\r\n    }).then(res => {\r\n      if (res.data.success && res.data.errorCode == \"-1\") {\r\n        // console.log(res.data);\r\n        this.progresslist = res.data.body.dictValueList;\r\n      } else {\r\n        this.$message.error(res.data.msg);\r\n      }\r\n    });\r\n  },\r\n  components: {\r\n    Navbar\r\n  },\r\n  mounted() {\r\n    let objs = {\r\n      userId: JSON.parse(localStorage.getItem(\"userinfo\")).isd,\r\n      pageNo:this.page,\r\n      pageSize:this.pagesize,\r\n    };\r\n    this.userinfo = JSON.parse(localStorage.getItem(\"userinfo\")); //登录页面缓存 userId\r\n    this.init(objs); //线索台账首页\r\n  },\r\n  methods: {\r\n    //下标处理\r\n    indexinfo(value) {\r\n      return value + 1 > 9 ? value + 1 : \"0\" + (value + 1);\r\n    },\r\n    // 表格样式的处理\r\n    cellStyle({ row, column, rowIndex, columnIndex }) {\r\n      //基数偶数延时不同\r\n      if (rowIndex % 2 != 0) {\r\n        return {\r\n          \"background-color\": \"#2162A8\",\r\n          \"text-align\": \"center\",\r\n          color: \"#fff\",\r\n          \"font-weight\": \"normal\",\r\n          padding: \"5px 0\"\r\n        };\r\n      } else {\r\n        return {\r\n          \"background-color\": \"#02468F\",\r\n          \"text-align\": \"center\",\r\n          color: \"#fff\",\r\n          \"font-weight\": \"normal\",\r\n          padding: \"5px 0\"\r\n        };\r\n      }\r\n    },\r\n    headerCellStyle({ row, rowIndex }) {\r\n      return {\r\n        \"background-color\": \"#027DBC\",\r\n        \"text-align\": \"center\",\r\n        color: \"#fff\",\r\n        \"font-weight\": \"normal\",\r\n        \"font-size\": \"16px\"\r\n      };\r\n    },\r\n\r\n    //表格内容的切换\r\n    handleSearchTable(index) {\r\n      this.pages = index;\r\n      let that = this\r\n      let tablearr = []; \r\n      this.totalList[index].cluesParameterList.map(function(lists) {\r\n        let obj = {\r\n          createDate: lists.createDate.split(\" \")[0],\r\n          clueStoTheSource: lists.clueStoTheSource,\r\n          letterNumber: lists.letterNumber,\r\n          clueNumber: lists.clueNumber,\r\n          disponsalWay: lists.disponsalWay,\r\n          name: lists.personnel?lists.personnel.name:\"\",\r\n          office: lists.office,\r\n          presentOccupation: lists.personnel?lists.personnel.presentOccupation:\"\",\r\n          id: lists.id //线索台账id\r\n        }\r\n        for (let s = 0; s < that.sourcelist.length; s++) {\r\n          if (that.sourcelist[s].value == lists.clueStoTheSource) {\r\n            obj.clueStoTheSource = that.sourcelist[s].label;\r\n          }\r\n        }\r\n        for (let s = 0; s < that.progresslist.length; s++) {\r\n          if (that.progresslist[s].value == lists.disponsalWay) {\r\n            obj.disponsalWay = that.progresslist[s].label;\r\n          }\r\n        }\r\n        tablearr.push(obj);\r\n      });\r\n      this.tableData = tablearr;\r\n    },\r\n    // 页面跳转 台账录入 参数userid 人员调动记录id\r\n    goLink(e) {\r\n      this.$router.push({path: e,});\r\n    },\r\n    //查看详情\r\n    handleEdit(index) {\r\n      let id = this.tableData[index].id\r\n      this.$router.push({path: \"/standBookEnter\",query: {id: id,ifupdata:1}});\r\n    },\r\n    //修改\r\n    updatabtn(index){\r\n      let id = this.tableData[index].id\r\n      this.$router.push({path: \"/standBookEnter\",query: {id: id}});\r\n    },\r\n    //初始化\r\n    init(objs) {\r\n      //线索台账首页\r\n      this.$ajax({\r\n        method: \"post\",\r\n        url: this.globals.requesturl + \"web/cluesparameter/index\",\r\n        data: objs,\r\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n        transformRequest: [\r\n          function(data) {\r\n            return qs.stringify(data);\r\n          }\r\n        ]\r\n      }).then(res => {\r\n        let that = this;\r\n        if (res.data.errorCode == \"-1\") {\r\n          that.loading=false\r\n          let arrList = res.data.body.list;\r\n          let oner = true\r\n          oner = arrList[0]\r\n          arrList.map(function(list) {\r\n            that.totalList.push(list);\r\n          });\r\n          //表格列表\r\n          let tablearr = []; \r\n            if (arrList[0].cluesParameterList.length > 0) {\r\n              for (let j = 0; j < arrList[0].cluesParameterList.length; j++) {\r\n                let lists = arrList[0].cluesParameterList[j];\r\n                let obj = {\r\n                  createDate: lists.createDate.split(\" \")[0],\r\n                  clueStoTheSource: lists.clueStoTheSource,\r\n                  letterNumber: lists.letterNumber,\r\n                  clueNumber: lists.clueNumber,\r\n                  disponsalWay: lists.disponsalWay,\r\n                  name: lists.personnel?lists.personnel.name:\"\",\r\n                  office: lists.personnel?lists.personnel.office.name:\"\",\r\n                  presentOccupation: lists.personnel?lists.personnel.presentOccupation:\"\",\r\n                  id: lists.id //线索台账id\r\n                };\r\n                for (let s = 0; s < that.sourcelist.length; s++) {\r\n                  if (that.sourcelist[s].value == lists.clueStoTheSource) {\r\n                    obj.clueStoTheSource = that.sourcelist[s].label;\r\n                  }\r\n                }\r\n                for (let s = 0; s < that.progresslist.length; s++) {\r\n                  if (that.progresslist[s].value == lists.disponsalWay) {\r\n                    obj.disponsalWay = that.progresslist[s].label;\r\n                  }\r\n                }\r\n                tablearr.push(obj);\r\n              }\r\n              that.tableData = tablearr;\r\n            }\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n        }\r\n      });\r\n    },\r\n    //关键字查询\r\n    searckkeyword() {\r\n      let objs = {\r\n        userId: JSON.parse(localStorage.getItem(\"userinfo\")).isd,\r\n        keyword: this.keyworktext\r\n      };\r\n      let that = this;\r\n      that.loading=true\r\n      this.$ajax({\r\n        method: \"POST\",\r\n        url: that.globals.requesturl + \"web/cluesparameter/solrSelect\",\r\n        data: objs,\r\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n        transformRequest: [\r\n          function(data) {\r\n            return qs.stringify(data);\r\n          }\r\n        ]\r\n      }).then(res => {\r\n        if (res.data.success && res.data.errorCode == \"-1\") {\r\n          let tablearr = [];that.loading=false;\r\n          for (let w = 0; w < res.data.body.list.length; w++) {\r\n            for (let i = 0; i < res.data.body.list[w].cluesParameterList.length; i++ ) {\r\n              let lists = res.data.body.list[w].cluesParameterList[i];\r\n              let obj = {\r\n                createDate: lists.createDate.split(\" \")[0],\r\n                clueStoTheSource: lists.clueStoTheSource,\r\n                letterNumber: lists.letterNumber,\r\n                clueNumber: lists.clueNumber,\r\n                disponsalWay: lists.disponsalWay,\r\n                name: lists.personnel.name,\r\n                office: lists.personnel.office.name,\r\n                presentOccupation: lists.personnel.presentOccupation,\r\n                id: lists.id //线索台账id\r\n              };\r\n              for (let s = 0; s < that.sourcelist.length; s++) {\r\n                if (that.sourcelist[s].value == lists.clueStoTheSource) {\r\n                  obj.clueStoTheSource = that.sourcelist[s].label;\r\n                }\r\n              }\r\n              for (let s = 0; s < that.progresslist.length; s++) {\r\n                if (that.progresslist[s].value == lists.disponsalWay) {\r\n                  obj.disponsalWay = that.progresslist[s].label;\r\n                }\r\n              }\r\n              tablearr.push(obj);\r\n            }\r\n            that.tableData = tablearr;\r\n          }\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n        }\r\n      });\r\n    },\r\n    //导出\r\n    exportbtn(){\r\n      let that=this,ids=[]\r\n      if(that.tableData.length == 0){\r\n        this.$message.error(\"暂无数据\");\r\n      }else{\r\n        that.tableData.map(function(list){\r\n          console.log(list)\r\n          ids.push(list.id)\r\n        })\r\n        let objstr = {\r\n          ids: ids.join(),\r\n          userId: JSON.parse(localStorage.getItem('userinfo')).isd,\r\n        }\r\n        this.$ajax({\r\n          method: \"POST\",\r\n          url: this.globals.requesturl + 'web/cluesparameter/export',\r\n          data: objstr,\r\n          headers: {'Content-Type': 'application/x-www-form-urlencoded'},\r\n          transformRequest: [function (data) { \r\n            return qs.stringify(data)\r\n          }]\r\n        }).then(res=>{\r\n          if(res.data.errorCode == \"-1\"){\r\n            console.log(res.data)\r\n            let url = res.data.body.path\r\n            let link = document.createElement('a')\r\n            console.log(link)\r\n            link.style.display = 'none'\r\n            link.href = url\r\n            link.setAttribute('download','')\r\n            document.body.appendChild(link)\r\n            link.click()\r\n            this.$message.success(res.data.msg); \r\n          }else{\r\n            this.$message.error(res.data.msg); \r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n};\r\n",null]}