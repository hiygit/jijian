{"remainingRequest":"f:\\纪检项目\\monitor\\byqc\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!f:\\纪检项目\\monitor\\byqc\\src\\views\\updateprogress\\index.vue?vue&type=script&lang=js&","dependencies":[{"path":"f:\\纪检项目\\monitor\\byqc\\src\\views\\updateprogress\\index.vue","mtime":1576460715637},{"path":"f:\\纪检项目\\monitor\\byqc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"f:\\纪检项目\\monitor\\byqc\\node_modules\\thread-loader\\dist\\cjs.js","mtime":499162500000},{"path":"f:\\纪检项目\\monitor\\byqc\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"f:\\纪检项目\\monitor\\byqc\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"f:\\纪检项目\\monitor\\byqc\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\nimport qs from \"qs\";\r\nexport default {\r\n  name: \"StandBookEnter\",\r\n  // props: {},\r\n  data() {\r\n    return {\r\n      isdisable:false,\r\n      id: [],\r\n      isShow: false,\r\n      personnelpops: false, //弹框显示切换\r\n      disponsalWay: \"\", //处置方式\r\n      fileRecordList: [], //处置方式记录附件列表\r\n      content: [],\r\n      contenarr: [],\r\n      proposedDispositionList: [],\r\n      pages: 1,\r\n      step: null, //进度步骤\r\n      nextspan: 0,\r\n      textareaobj: {\r\n        disponsalWay: \"\",\r\n        textarealist: [\r\n          { content: \"\", id: \"\", disponsalWay: 2 },\r\n          { content: \"\", id: \"\", disponsalWay: 3 },\r\n          { content: \"\", id: \"\", disponsalWay: 4 },\r\n          { content: \"\", id: \"\", disponsalWay: 5 },\r\n          { content: \"\", id: \"\", disponsalWay: 6 },\r\n          { content: \"\", id: \"\", disponsalWay: 7 },\r\n          { content: \"\", id: \"\", disponsalWay: 8 },\r\n          { content: \"\", id: \"\", disponsalWay: 9 }\r\n        ]\r\n      }\r\n    };\r\n  },\r\n  computed: {},\r\n  methods: {},\r\n  components: {},\r\n  created() {\r\n    document.title = \"线索台账修改进度\";\r\n\r\n      let that = this\r\n      //处置意见\r\n      this.$ajax({\r\n      method: \"POST\",\r\n      url: this.globals.requesturl + \"web/dict\",\r\n      data: { type: \"disponsal_way\" },\r\n      headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n      transformRequest: [\r\n        function(data) {\r\n          return qs.stringify(data);\r\n        }\r\n      ]\r\n    }).then(res=>{\r\n      if (res.data.success && res.data.errorCode == \"-1\") {\r\n        this.proposedDispositionList = res.data.body.dictValueList\r\n        console.log(this.proposedDispositionList)\r\n      }else{\r\n        this.$message.error(res.data.msg);\r\n      }\r\n    })\r\n  },\r\n  mounted() {\r\n    let id = this.$route.query.id;\r\n    this.init();\r\n  },\r\n  watch: {},\r\n  methods: {\r\n    disposeIdeaList: [],//处置方式\r\n    // 个人中心Tab切换\r\n    get(e) {\r\n      // console.log(e);\r\n      this.pages = e;\r\n    },\r\n    leftget(dex){\r\n      if(this.step == dex){\r\n        this.disable = false\r\n      }else{\r\n        this.disable = true\r\n      }\r\n      this.step = dex\r\n      this.isShow = dex==2?true:false\r\n    },\r\n    init() {\r\n      let that = this;\r\n      let objs = {\r\n        id: this.$route.query.id,\r\n        userId: JSON.parse(localStorage.getItem(\"userinfo\")).isd\r\n      };\r\n      this.$ajax({\r\n        method: \"POST\",\r\n        url: that.globals.requesturl + \"web/cluesparameter/record\",\r\n        data: objs,\r\n        headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n        transformRequest: [\r\n          function(data) {\r\n            return qs.stringify(data);\r\n          }\r\n        ]\r\n      }).then(res => {\r\n        if (res.data.success && res.data.errorCode == \"-1\") {\r\n          if(!res.data.body.disponsalWay){\r\n              that.isShow = false;\r\n              that.step = 0 \r\n          }else if(res.data.body.disponsalWay == 0){\r\n            that.step = 0\r\n          }else if(res.data.body.disponsalWay == 1){\r\n            that.step = 1\r\n          }else if(res.data.body.disponsalWay==2||res.data.body.disponsalWay==3||res.data.body.disponsalWay==4||res.data.body.disponsalWay==5||res.data.body.disponsalWay==6||res.data.body.disponsalWay==7||res.data.body.disponsalWay==8||res.data.body.disponsalWay==9){\r\n            that.step = 2\r\n            this.isShow =true\r\n          }else if(res.data.body.disponsalWay == 10){\r\n            that.step = 3\r\n          }else if(res.data.body.disponsalWay == 11){\r\n            that.step = 4\r\n          }\r\n          that.disponsalWay = 0 \r\n          // that.number = that.number+1\r\n          let arrlist = res.data.body.recordList;\r\n\r\n          that.textareaobj.disponsalWay = res.data.body.disponsalWay;\r\n          that.contenarr = res.data.body.recordList;\r\n          for (let i = 0; i < arrlist.length; i++) {\r\n            for (let j = 0; j < that.textareaobj.textarealist.length; j++) {\r\n              if (arrlist[i].disponsalWay == res.data.body.disponsalWay) {\r\n                that.textareaobj.textarealist[j].content = arrlist[i].content;\r\n                that.textareaobj.textarealist[j].id = arrlist[i].id;\r\n              }\r\n            }\r\n          }\r\n          console.log(arrlist)\r\n          let totalList = [];\r\n          let contents = []; //文本域内容显示\r\n          let idid = [];\r\n          arrlist.map(function(list) {\r\n            that.disponsalWay = list.disponsalWay;\r\n            console.log(list)\r\n            if (list.disponsalWay == 0) {\r\n              that.disponsalWay = 0;\r\n              that.isShow = false;\r\n            } else if (list.disponsalWay == 0) {\r\n              that.disponsalWay = 1;\r\n              that.isShow = false;\r\n            } else if (\r\n              list.disponsalWay == 2 ||\r\n              list.disponsalWay == 3 ||\r\n              list.disponsalWay == 4 ||\r\n              list.disponsalWay == 5 ||\r\n              list.disponsalWay == 6 ||\r\n              list.disponsalWay == 7 ||\r\n              list.disponsalWay == 8 ||\r\n              list.disponsalWay == 9\r\n            ) {\r\n              that.disponsalWay = 2;\r\n              that.isShow = false;\r\n            } else if (list.disponsalWay == 10) {\r\n              that.disponsalWay = 3;\r\n              that.isShow = true;\r\n            } else if (list.disponsalWay == 11) {\r\n              that.disponsalWay == 4;\r\n              that.isShow = false;\r\n            }else if (list.disponsalWay == \"\") {\r\n              that.isShow = false;\r\n            }\r\n            contents.push(list.content);\r\n            idid.push(list.id);\r\n            totalList.push(list);\r\n          });\r\n          that.content = contents.join(\"\\n\");\r\n          that.id = idid;\r\n          // that.step = that.disponsalWay;\r\n\r\n          // console.log(arrlist)\r\n          //循环拿到fileRecordList下的file 和 time\r\n          let preList = [];\r\n          for (let i = 0; i < arrlist.length; i++) {\r\n            if (arrlist[i].fileRecordList != 0) {\r\n              for (let j = 0; j < arrlist[i].fileRecordList.length; j++) {\r\n                let lists = arrlist[i].fileRecordList[j];\r\n                let number = 0;\r\n                let obj = {\r\n                  number: \"\",\r\n                  file: lists.file,\r\n                  time: lists.time\r\n                };\r\n                preList.push(obj);\r\n              }\r\n              that.fileRecordList = preList;\r\n            }\r\n          }\r\n        } else {\r\n          this.$message.error(res.data.msg);\r\n        }\r\n      });\r\n    },\r\n    //线索台账保存处置方式进度\r\n    saverecord() {\r\n      let that = this;\r\n      // console.log(that.textareaobj.disponsalWay)\r\n      // console.log(that.content)\r\n      that.textareaobj.textarealist.map(function(list) {\r\n        if (that.disponsalWay == list.disponsalWay) {\r\n          that.textareaobj.textarealist[that.pages - 1].content = list.content;\r\n          that.textareaobj.textarealist[that.pages - 1].id = list.id;\r\n        }\r\n      });\r\n      let objs = \"\";\r\n      if(this.$route.query.id){\r\n        console.log(\"---\")\r\n        objs = {\r\n          \"cluesParameter.id\": that.$route.query.id, //线索台账id\r\n          disponsalWay: that.disponsalWay,\r\n          userId: JSON.parse(localStorage.getItem(\"userinfo\")).isd,\r\n          content: that.textareaobj.textarealist[that.pages - 1].content,\r\n          id: that.textareaobj.textarealist[that.pages - 1].id\r\n        };\r\n        this.$ajax({\r\n          method: \"post\",\r\n          url: this.globals.requesturl + \"web/cluesparameter/saveRecord\",\r\n          data: objs,\r\n          headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n          transformRequest: [\r\n            function(data) {\r\n              return qs.stringify(data);\r\n            }\r\n          ]\r\n        }).then(res => {\r\n          if (res.data.errorCode == \"-1\") {\r\n            console.log(res.data);\r\n            this.$message.success(res.data.msg);\r\n          } else {\r\n            this.$message.error(res.data.msg);\r\n          }\r\n        })\r\n      }else{\r\n        objs = JSON.parse(this.$route.query.str)\r\n        objs.disponsalWay = that.disponsalWay+\"\"\r\n        objs.content = that.textareaobj.textarealist[that.pages - 1].content\r\n        objs.recordId = that.textareaobj.textarealist[that.pages - 1].id\r\n        objs.dw = that.proposedDispositionList[that.nextspan].value,\r\n        this.$ajax({\r\n          method: \"post\",\r\n          url: this.globals.requesturl + \"web/cluesparameter/firstSave\",\r\n          data: objs,\r\n          headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n          transformRequest: [\r\n            function(data) {\r\n              return qs.stringify(data);\r\n            }\r\n          ]\r\n        }).then(res => {\r\n          console.log(res.data)\r\n          if (res.data.errorCode == \"-1\") {\r\n            this.$message.success(res.data.msg);\r\n            this.$router.push({path:'/standBook'})\r\n          } else {\r\n            this.$message.error(res.data.msg);\r\n          }\r\n        })\r\n      }\r\n    },\r\n    // 上传附件\r\n    headgetfile(event) {\r\n      console.log(\"olooooo\");\r\n      let that = this;\r\n      that.textareaobj.textarealist.map(function(list) {\r\n        if (that.disponsalWay == list.disponsalWay) {\r\n          that.textareaobj.textarealist[that.pages - 1].content = list.content;\r\n          that.textareaobj.textarealist[that.pages - 1].id = list.id;\r\n        }\r\n      });\r\n      // let objs = {\r\n      //   'cluesParameter.id': that.$route.query.id, //线索台账id\r\n      //   disponsalWay: that.disponsalWay,\r\n      //   userId: JSON.parse(localStorage.getItem('userinfo')).isd,\r\n      //   content: that.textareaobj.textarealist[that.pages-1].content,\r\n      //   id: that.textareaobj.textarealist[that.pages-1].id\r\n      // }\r\n\r\n      let filesarr = [];\r\n      let fileList = event.target.files;\r\n      let formdatas = new FormData();\r\n      formdatas.append(\r\n        \"userId\",\r\n        JSON.parse(localStorage.getItem(\"userinfo\")).isd\r\n      );\r\n      formdatas.append(\"disponsalWay\", that.disponsalWay);\r\n      formdatas.append(\r\n        \"content\",\r\n        that.textareaobj.textarealist[that.pages - 1].content\r\n      );\r\n      formdatas.append(\"id\", that.textareaobj.textarealist[that.pages - 1].id); // formdatas.append('files',fileList)\r\n      for (let i = 0; i < fileList.length; i++) {\r\n        formdatas.append(\"files\", fileList[i]);\r\n      }\r\n      this.$ajax({\r\n        method: \"POST\",\r\n        data: formdatas,\r\n        url: this.globals.requesturl + \"web/cluesparameter/uploadFile\",\r\n        headers: { \"Content-Type\": \"multipart/form-data\" } // transformRequest: [function (data) { //   return qs.stringify(data) // }]\r\n      }).then(\r\n        res => {\r\n          console.log(res.data);\r\n          this.fileList = []; //此处重置文件中间存储变量是为了相同文件能够重复传递\r\n          if (true === res.data.success) {\r\n            this.$message.success(`成功`);\r\n          } else {\r\n            this.$message.error(`失败`);\r\n            console.log(222);\r\n          }\r\n        },\r\n        err => {\r\n          this.$message.error(`失败`);\r\n        }\r\n      );\r\n    },\r\n    // 弹窗里的确定\r\n    submitchangeunit(){\r\n      // this.pages = this.nextspan+1 \r\n      // this.step = this.nextspan\r\n      if(this.$route.query.id){\r\n        if(this.nextspan < 2){\r\n          this.step = this.nextspan\r\n        }else if(this.nextspan > 9){\r\n          this.step = this.nextspan==10?3:this.nextspan==11?4:''\r\n        }else{\r\n          this.pages = this.nextspan-1\r\n        }\r\n\r\n        let that = this\r\n        let querstr = \"\";\r\n        let id = \"\";\r\n        that.textareaobj.textarealist.map(function(list){\r\n          if(that.textareaobj.disponsalWay == list.disponsalWay){\r\n            querstr = list.content\r\n            id = list.id\r\n          }\r\n        })\r\n        let requeststr = {\r\n          userId:JSON.parse(localStorage.getItem(\"userinfo\")).isd,\r\n          disponsalWay:that.textareaobj.disponsalWay,\r\n          content:querstr,\r\n          'dw':that.proposedDispositionList[that.nextspan].value,\r\n          id:id,\r\n          'cluesParameter.id': this.$route.query.id\r\n        }\r\n        this.$ajax({\r\n          method: \"POST\",\r\n          data: requeststr,\r\n          url: this.globals.requesturl + \"web/cluesparameter/saveRecord\",\r\n          headers: {'Content-Type': 'application/x-www-form-urlencoded'},\r\n          transformRequest: [function (data) { \r\n            return qs.stringify(data)\r\n          }]\r\n        }).then(res => {\r\n            if (res.data.success && res.data.errorCode == \"-1\") {\r\n              this.$message.success(`成功`);\r\n              this.personnelpops = false\r\n            this.$router.push({path:'/standBook'})\r\n            } else {\r\n              this.$message.error(`失败`);\r\n            }\r\n          },\r\n          err => {\r\n            this.$message.error(`失败`);\r\n          }\r\n        );\r\n      }else{\r\n        let that = this\r\n        let querstr = \"\";\r\n        let id = \"\";\r\n        that.textareaobj.textarealist.map(function(list){\r\n          if(that.textareaobj.disponsalWay == list.disponsalWay){\r\n            querstr = list.content\r\n            id = list.id\r\n          }\r\n        })\r\n        let requeststr = {\r\n          userId:JSON.parse(localStorage.getItem(\"userinfo\")).isd,\r\n          disponsalWay:that.textareaobj.disponsalWay,\r\n          content:querstr,\r\n          'dw':that.proposedDispositionList[that.nextspan].value,\r\n          id:id,\r\n          'cluesParameter.id': this.$route.query.id\r\n        }\r\n        requeststr = JSON.parse(this.$route.query.str)\r\n        requeststr.disponsalWay = that.disponsalWay+\"\"\r\n        requeststr.content = that.textareaobj.textarealist[that.pages - 1].content\r\n        requeststr.recordId = that.textareaobj.textarealist[that.pages - 1].id\r\n        requeststr.dw = that.proposedDispositionList[that.nextspan].value,\r\n        this.$ajax({\r\n          method: \"post\",\r\n          url: this.globals.requesturl + \"web/cluesparameter/firstSave\",\r\n          data: requeststr,\r\n          headers: { \"Content-Type\": \"application/x-www-form-urlencoded\" },\r\n          transformRequest: [\r\n            function(data) {\r\n              return qs.stringify(data);\r\n            }\r\n          ]\r\n        }).then(res => {\r\n          if (res.data.errorCode == \"-1\") {\r\n            this.$message.success(res.data.msg);\r\n            this.$router.push({path:'/standBook'})\r\n            this.personnelpops = false\r\n          } else {\r\n            this.$message.error(res.data.msg);\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n};\r\n",null]}